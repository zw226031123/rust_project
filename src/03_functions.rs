// ============================================================================
// Rust 学习笔记 03: 函数
// ============================================================================
//
// 函数是 Rust 程序的基本构建块。
// Rust 使用 snake_case 命名风格（全部小写，用下划线分隔单词）。
// 函数可以返回值，main 函数是程序的入口点。
//
// ============================================================================

fn main() {
    println!("Hello, world!");

    // ========== 1. 函数调用 ==========
    println!("调用 say_hello 函数:");
    say_hello();

    println!("\n调用带有参数的函数:");
    println!("5 + 3 = {}", add(5, 3));
    println!("10 + 20 = {}", add(10, 20));

    // ========== 2. 语句与表达式 ==========
    // Rust 的函数体由一系列语句组成，可以以表达式结尾

    let y = {
        let x = 3;
        x + 1  // 注意：这里没有分号，是表达式
    };
    println!("y 的值: {}", y);

    // ========== 3. 函数的返回值 ==========
    println!("\n函数的返回值:");

    let result = five();
    println!("five() 返回: {}", result);

    let result2 = plus_one(5);
    println!("plus_one(5) 返回: {}", result2);

    // ========== 4. 早期返回 ==========
    println!("\n早期返回示例:");
    let result3 = return_early();
    println!("return_early() 返回: {}", result3);

    // ========== 5. 函数指针 ==========
    println!("\n函数指针示例:");
    let func_ptr: fn(i32, i32) -> i32 = add;
    println!("通过函数指针调用 add(3, 4): {}", func_ptr(3, 4));

    // ========== 6. 方法 vs 函数 ==========
    // 方法是与结构体、枚举或trait对象关联的函数
    // 使用点语法调用: object.method()

    println!("\n方法调用示例:");
    let rect = Rectangle { width: 30, height: 50 };
    println!("矩形面积: {}", rect.area());

    // 静态方法调用（使用 :: 运算符）
    let square = Rectangle::square(10);
    println!("正方形面积: {}", square.area());

    // ========== 7. 泛型函数 ==========
    println!("\n泛型函数示例:");
    let int_max = max(5, 10);
    let float_max = max(3.14, 2.71);
    println!("整数最大值: {}", int_max);
    println!("浮点数最大值: {}", float_max);

    // ========== 8. 高阶函数 ==========
    println!("\n高阶函数示例:");
    let numbers = [1, 2, 3, 4, 5];
    let doubled: Vec<i32> = numbers.iter().map(|x| x * 2).collect();
    println!("原始数组: {:?}", numbers);
    println!("加倍后: {:?}", doubled);
}

// ============================================================================
// 函数定义
// ============================================================================

// ---------- 基本函数 ----------
fn say_hello() {
    println!("Hello, Rust!");
}

// ---------- 带参数的函数 ----------
fn add(a: i32, b: i32) -> i32 {
    // Rust 中，函数最后一行（没有分号）就是返回值
    a + b
}

// 也可以显式使用 return 关键字
fn subtract(a: i32, b: i32) -> i32 {
    return a - b;
}

// ---------- 返回值的函数 ----------
// 如果函数不返回任何值，实际返回的是 ()（空元组）
fn five() -> i32 {
    5
}

fn plus_one(x: i32) -> i32 {
    x + 1
}

// ---------- 早期返回 ----------
fn return_early() -> &str {
    // 可以使用 return 提前返回
    if true {
        return "提前返回";
    }
    // 这行永远不会执行
    println!("这行不会执行");
    "正常返回"
}

// ============================================================================
// 结构体定义（用于方法示例）
// ============================================================================

struct Rectangle {
    width: u32,
    height: u32,
}

// ---------- 方法定义 ----------
// impl 块中定义的函数称为方法
impl Rectangle {
    // 实例方法：第一个参数是 self（指向自身的引用）
    fn area(&self) -> u32 {
        self.width * self.height
    }

    // 可以修改 self（需要 &mut self）
    fn set_width(&mut self, width: u32) {
        self.width = width;
    }

    // 可以获取所有权（不常用）
    // fn into_square(self) -> Rectangle { ... }
}

// ---------- 关联函数 ----------
// 不以 self 为参数的函数，称为关联函数（类似静态方法）
impl Rectangle {
    // 创建一个正方形
    fn square(size: u32) -> Self {
        Self { width: size, height: size }
    }
}

// ============================================================================
// 泛型函数
// ============================================================================

// T 必须实现 PartialOrd trait，才能比较大小
fn max<T: PartialOrd>(a: T, b: T) -> T {
    if a > b {
        a
    } else {
        b
    }
}

// ============================================================================
// 总结
// ============================================================================
//
// 1. 函数使用 fn 关键字定义
// 2. 命名风格：snake_case
// 3. 参数需要标注类型
// 4. 返回值类型使用 -> 标注（-> () 可省略）
// 5. 函数体中的表达式返回值，最后一个表达式即为返回值
// 6. return 关键字可用于提前返回
// 7. 方法是与类型关联的函数，使用 impl 块定义
// 8. 关联函数使用 :: 调用，类似静态方法
// 9. 泛型函数可以处理多种类型
//
